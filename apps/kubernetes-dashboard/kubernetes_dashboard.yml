---
- hosts: apis_1
  vars:
     helm_chart_url: "https://kubernetes.github.io/dashboard/"
  tasks:
    
    # add helm repo
    - name: Add helm repo
      kubernetes.core.helm_repository:
        name: kubernetes-dashboard
        repo_url: "{{ helm_chart_url }}"

    # install a chart from said repo
    - name: Install Dashboard Chart
      kubernetes.core.helm:
        name: kubernetes-dashboard
        namespace: kubernetes-dashboard
        chart_ref: kubernetes-dashboard/kubernetes-dashboard

    # install chart
    - name: Install Nginx Chart
      kubernetes.core.helm:
        name: kubernetes-dashboard
        namespace: kubernetes-dashboard
        chart_ref: kubernetes-dashboard/kubernetes-dashboard
        # state: absent
        # values:
        #   service:
        #     loadBalancerIP: 192.168.13.238
        
    # get info about installed chart
    - name: Gather information about kubernetes-dashboard
      kubernetes.core.helm_info:
        name: kubernetes-dashboard
        release_namespace: kubernetes-dashboard